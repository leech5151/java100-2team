<link rel="stylesheet" href="../../myDesign/pet/pet.css">

<div class="modal-header"  style="padding: 5% 5% 5% 5%;">
    <h4>
        <span class="glyphicon glyphicon-lock"></span> 미아 등록
    </h4>
    <button type="button" class="close" data-dismiss="modal">&times;</button>
</div>

<div class="w3-content w3-display-container" style="max-width: 90%; height: 70vh; margin-top: 1%;">
<form id="fileForm" enctype="multipart/form-data">

  <img id="lostPetPhoto" class="mySlides2" style="width: 35rem; height: 35vh; margin-top: 3rem;" src= "https://static.wixstatic.com/media/5bfb6f_1534be33e38b46dba2fcf0d135b70972~mv2.png/v1/fill/w_750,h_788,al_c,usm_0.66_1.00_0.01/5bfb6f_1534be33e38b46dba2fcf0d135b70972~mv2.png" alt=''>
  <div class="mySlides3" style="width: 35rem; height: 23vh; background-color: black;">
  <div style="width: 40%; float: left; margin-top: 3%; margin-left: 10%;">
  <p style="color: gray;">
      <input id="petName" type="text" name="petName" style="width: 14rem;" placeholder="이름을 입력하세요."> 
      <br><br>
      <input id="breed" type="text" name="breed" style="width: 14rem;" placeholder="품종을 입력하세요."> 
      <br><br>
      <input id="lostLocation" type="text" name="lostLocation" style="width: 14rem;" placeholder="분실 장소를 입력하세요.">
      <br><br>
      분실일 : <input id='lostDate' type='date' name='lostDate' style="width: 10.2rem;">
  </p>
  </div>
  <div style="width: 37%; float: left; margin-top: 3%; margin-left: 10%;">
  <p style="color: white; margin-left: -1rem;">
      <input id='character' type='text' name='character' style="width: 14rem;" placeholder="특징을 입력하세요.">
      <br><br>
      알람 전송 : <input id='pushAlert' type="checkbox" name='pushAlert' style="width: 1rem;">
      <input id='reward' type='text' name='reward' style="width: 6.5rem;" placeholder="사례금 입력">
      <br><br>
      <input id='contents' type='text' name='contents' style="width: 14rem;" placeholder="기타 알릴 사항을 입력하세요.">
      <br><br>
      <input id="file" type="file" name="file" style="width: 10rem; color: black;" >
  </p>
  </div>
  </div>

</form>
</div>

<div style="width: 100%; height: 8vh;">
<button style="margin: 0 0 0 34.5rem;" id="addBtn2" type="button" class='btn btn-primary btn-sm'>등록</button>
</div>

<script src='../../node_modules/jquery/dist/jquery.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src='../../node_modules/sweetalert/dist/sweetalert.min.js'></script>
<script src="../../node_modules/sweetalert2/dist/sweetalert2.all.js"></script>

<script type="text/javascript">
var addBtn2 = $('#addBtn2'),
    updateBtn = $('#updateBtn'),
    deleteBtn = $('#deleteBtn'),
    lostNoItem = $('#lostNo'),
    petNameItem = $('#petName'),
    breedItem = $('#breed'),
    lostLocationItem = $('#lostLocation'),
    lostDateItem = $('#lostDate'),
    characterItem = $('#character'),
    rewardItem = $('#reward'),
    viewCountItem = $('#viewCount'),
    contentsItem = $('#contents'),
    attFile = $('#attFile'),
    fileItem = $('#file'),
    lostNum = $('#lostNum');
    viewC = $('#viewC'),
    logout = $('#logout');

$(function() {
  $("#file").on('change', function(){
      readURL(this);
  });
});

function readURL(input) {
    if (input.files && input.files[0]) {
    var reader = new FileReader();
    reader.onload = function (e) {
            $('#lostPetPhoto').attr('src', e.target.result);
    }

      reader.readAsDataURL(input.files[0]);
    } 
}
var index = location.href.indexOf('?');
if (index != -1) {
    var qs = location.href.substr(index + 1);
    var arr = qs.split('=');

    $('.my-new').css('display', 'none');
    $(function load() {
        $.ajax('../../json/lost/' + arr[1], {
            dataType: 'json',
            success: (result) => {
            	console.log(result);
            	$('#lostNum').html("<input class='form-control' readonly id='lostNo' type='number' name='lostNo' value='" + result.data.lostNo + "'>");
            	lostNoItem.val(result.data.lostNo);
            	$('#viewC').html("<input class='form-control' readonly id='viewCount' type='number' name='viewCount' value='" + result.data.viewCount + "'>");
            	viewCountItem.val(result.data.viewCount);
            	petNameItem.val(result.data.petName);
            	breedItem.val(result.data.breed);
            	lostLocationItem.val(result.data.lostLocation);
            	lostDateItem.val(result.data.lostDate);
            	characterItem.val(result.data.character);
            	rewardItem.val(result.data.reward);
            	contentsItem.val(result.data.contents);
            	for (var file of result.data.files) {
            		$('#attFile').html("<a href='../../download/" + file.filename + "'>" + file.filename + "</a>")
            	}
            	
            },
            error: () => {
                window.alert('서버 실행 오류!');
            }
        });
    });
    
} else {
    $('.my-view').css('display', 'none');
}

addBtn2.click(() => {
    var formData = new FormData($("#fileForm")[0]);
//      console.log(formData.get('petName'))
    $.ajax('../../json/lost/add', {
        data: formData,
        dataType: 'json',
        method: 'POST',
        processData : false,
        contentType : false,
        success: (result) => {
         	location.href = '../main/home.html';
        },
        error: (jqXHR, textStatus, errorThrown) => {
            swal("등록 실패!", "정보를 확인해보세요!", "error");
        }
    });
});

updateBtn.click(() => {
	var formData = new FormData($("#fileForm")[0]);
    $.ajax('../../json/lost/update', {
        data: formData,
        dataType: 'json',
        method: 'POST',
        processData : false,
        contentType : false,
        success: (result) => {
        location.href = "../main/home.html#awards";
        },
        error: (jqXHR, textStatus, errorThrown) => {
            swal("수정 실패!", "정보를 확인 해보세요!", "error");
            /* window.alert('서버 실행 오류!'); */
        }
    });
});

deleteBtn.click(() => {

    $.ajax('../../json/lost/delete', {
        data: {
        	no: $('#lostNo').val()
        },
        dataType: 'json',
        success: (result) => {
        location.href = "../main/home.html#awards";
        },
        error: () => {
            swal("삭제 실패!", "다시 시도해보세요!", "error");
        }
    });
});

</script>

</body>
</html>


























