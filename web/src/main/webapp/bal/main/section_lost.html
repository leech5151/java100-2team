<meta charset="UTF-8">
<link href="../../myDesign/lost/lost.css" rel="stylesheet">
<link href="../../myDesign/lost/lost2.css" rel="stylesheet">

<div class="bal-mb-3">
    <div style="margin-top: 15%;text-align: left;">
    <h2>Lost</h2>
    <div>
    
<nav aria-label="Page navigation" style="position: relative; float: left; width: 100%;">
<button id="prevBtn" class="btn btn-sm btn-light before-login" style="margin-left: 44%; color: blue;">이전</button>
<button id="nextBtn" class="btn btn-sm btn-light before-login" style="color: blue;">다음</button>
<button id="addBtn" type="button" class="btn btn-danger btn-sm after-login">미아 등록</button>
<button id="prevBtn" class="btn btn-sm btn-light after-login" style="margin-left: 35%; color: blue;">이전</button>
<button id="nextBtn" class="btn btn-sm btn-light after-login" style="color: blue;">다음</button>
</nav>
<br>
<br>
<br>
</div>
    <div id="lostList" class="bal-mb-3-list"></div>
    </div>
</div>
<script id="lostTemplate" type="text/x-handlebars-template">

{{#each list}}

<div class="bal-mb-3-data lostData">
<figure class="snip1283">
{{#each files}}
<img src="../../download/{{filename}}" alt="{{filename}}" style="width:100%; height:100%;">
{{/each}}
<figcaption>
<h3 style="text-align: center;"> < {{petName}} > </h3>
    <p style="font-size: 20px;">품종 : {{breed}}</p>
    <p style="font-size: 20px;">연락처 : {{registrant.tel}}</p>
<div><a href="../lost/lostList.html" class="read-more">Read More</a></div>
</figcaption>
</figure>
</a>
</div>

{{/each}}
</script>

<script src='../../node_modules/handlebars/dist/handlebars.min.js'></script>
<script src='../../node_modules/jquery/dist/jquery.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src='../../node_modules/sweetalert/dist/sweetalert.min.js'></script>
<script src="../../node_modules/sweetalert2/dist/sweetalert2.all.js"></script>

<script type="text/javascript">
var pageNo = 1,
    list = $('#lostList'),      
    lostTemplateSrc = $('#lostTemplate').html(),
    lostTemplateEngine = Handlebars.compile(lostTemplateSrc);
    

$.getJSON('../../json/auth/loginUser', (result) => {
    if (result.status == 'fail') {
        $('.after-login').css('display', 'none');
    }
    
    var options = {};
    options.pn = pageNo;
    $.ajax('../../json/lost/list', {
        data: options,
        dataType: 'json',
        success: (result) => {
           list.append(lostTemplateEngine(result));

		    $('button').click(function(e){
	            var id = e.target.getAttribute('id');
	            if ((id != '') && (id != null))  
	            var newId = '#' + id;
	    
			    if (newId == '#addBtn') {
			    	modalStart();
			    } else if ((newId == '#prevBtn')) {
	    			pageNo = pageCalculator(-1, result.lastPageNo)
			    	pageChange(pageNo, options)
			    } else if (newId == '#nextBtn') {
	    			pageNo = pageCalculator(1, result.lastPageNo)
			    	pageChange(pageNo, options)
			    } else {}
		    });
       }
    });
});

function pageCalculator(n, lastPageNo) {
   pageNo += n;
   if (pageNo > lastPageNo) {
	   pageNo = 1;
   } else if (pageNo == 0) {
	   pageNo = lastPageNo;
   }
   return pageNo;
}

function pageChange(pageNo, options) {

	$('.lostData').remove();
	options.pn = pageNo;
    $.ajax('../../json/lost/list', {
        data: options,
        dataType: 'json',
        success: (result) => {
           list.append(lostTemplateEngine(result));
           location.href = "../main/home.html#lost";
       }
    });
}

function modalStart() {
	var lostFormAddModal = $('#lostFormAddModal');
	var lostFormAddModalContent = $('#lostFormAddModal .modal-content');
    event.preventDefault();
    event.stopPropagation();
    lostFormAddModalContent.load('../lost/lostForm.html', () => {
    	lostFormAddModal.modal();
    });
}

</script>
